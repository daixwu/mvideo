!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e["bundle-name"]=t()}(this,function(){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(t,i,n){function e(e){n&&!n(t,i)||e.stopImmediatePropagation()}return t.addEventListener(i,e),e}function o(e,t,i,n){function r(e){i[t]=e}n&&r(e[t]),Object.defineProperty(e,t,{get:function(){return i[t]},set:r})}function s(e,t,i){i.addEventListener(t,function(){return e.dispatchEvent(new Event(t))})}function d(e,t){Promise.resolve().then(function(){e.dispatchEvent(new Event(t))})}var u="object"==typeof document&&"object-fit"in document.head.style&&!matchMedia("(-webkit-video-playable-inline)").matches,l="bfred-it:iphone-inline-video",c="bfred-it:iphone-inline-video:event",p="bfred-it:iphone-inline-video:nativeplay",v="bfred-it:iphone-inline-video:nativepause";var n,y=[],h=0;function f(e,t,i){(n||0)+200<Date.now()&&(e[c]=!0,n=Date.now()),i||(e.currentTime=t),y[++h%3]=100*t|0}function m(e){return e.driver.currentTime>=e.video.duration}function g(){var e=this,t=e[l];e.webkitDisplayingFullscreen?e[p]():("data:"!==t.driver.src&&t.driver.src!==e.src&&(f(e,0,!0),t.driver.src=e.src),e.paused&&(t.paused=!1,0===e.buffered.length&&e.load(),t.driver.play(),t.updater.start(),t.hasAudio||(d(e,"play"),t.video.readyState>=t.video.HAVE_ENOUGH_DATA&&d(e,"playing"))))}function b(e){var t=this,i=t[l];i.driver.pause(),i.updater.stop(),t.webkitDisplayingFullscreen&&t[v](),i.paused&&!e||(i.paused=!0,i.hasAudio||d(t,"pause"),t.ended&&!t.webkitDisplayingFullscreen&&(t[c]=!0,d(t,"ended")))}function k(t,i){var e,n,r={};(t[l]=r).paused=!0,r.hasAudio=i,r.video=t,r.updater=function(t,i,e,n){var r,a;function o(e){r=i(o,n),t(e-(a||e)),a=e}return{start:function(){r||o(0)},stop:function(){e(r),r=null,a=0}}}(function(e){var t=this;t.video.readyState>=t.video.HAVE_FUTURE_DATA?(t.hasAudio||(t.driver.currentTime=t.video.currentTime+e*t.video.playbackRate/1e3,t.video.loop&&m(t)&&(t.driver.currentTime=0)),f(t.video,t.driver.currentTime)):t.video.networkState===t.video.NETWORK_IDLE&&0===t.video.buffered.length&&t.video.load(),t.video.ended&&(delete t.video[c],t.video.pause(!0))}.bind(r),requestAnimationFrame,cancelAnimationFrame),r.driver=i?(e=t,n=new Audio,s(e,"play",n),s(e,"playing",n),s(e,"pause",n),n.crossOrigin=e.crossOrigin,n.src=e.src||e.currentSrc||"data:",n):(t.addEventListener("canplay",function(){t.paused||d(t,"playing")}),{src:t.src||t.currentSrc||"data:",muted:!0,paused:!0,pause:function(){r.driver.paused=!0},play:function(){r.driver.paused=!1,m(r)&&f(t,0)},get ended(){return m(r)}}),t.addEventListener("emptied",function(){var e=!r.driver.src||"data:"===r.driver.src;r.driver.src&&r.driver.src!==t.src&&(f(t,0,!0),r.driver.src=t.src,e||!i&&t.autoplay?r.driver.play():r.updater.stop())},!1),t.addEventListener("webkitbeginfullscreen",function(){t.paused?i&&0===r.driver.buffered.length&&r.driver.load():(t.pause(),t[p]())}),i&&(t.addEventListener("webkitendfullscreen",function(){r.driver.currentTime=t.currentTime}),t.addEventListener("seeking",function(){y.indexOf(100*t.currentTime|0)<0&&(r.driver.currentTime=t.currentTime)}))}function w(e){var t=e[c];return delete e[c],!e.webkitDisplayingFullscreen&&!t}function A(t,e){if(void 0===e&&(e={}),!t[l]){if(!e.everywhere){if(!u)return;if(!(e.iPad||e.ipad?/iPhone|iPod|iPad/:/iPhone|iPod/).test(navigator.userAgent))return}t.pause();var i,n,r=t.autoplay;t.autoplay=!1,k(t,!t.muted),n=(i=t)[l],i[p]=i.play,i[v]=i.pause,i.play=g,i.pause=b,o(i,"paused",n.driver),o(i,"muted",n.driver,!0),o(i,"playbackRate",n.driver,!0),o(i,"ended",n.driver),o(i,"loop",n.driver,!0),a(i,"seeking",function(e){return!e.webkitDisplayingFullscreen}),a(i,"seeked",function(e){return!e.webkitDisplayingFullscreen}),a(i,"timeupdate",w),a(i,"ended",w),t.classList.add("IIV"),t.muted&&r&&(t.play(),t.addEventListener("playing",function e(){t.autoplay=!0,t.removeEventListener("playing",e)})),/iPhone|iPod|iPad/.test(navigator.platform)||console.warn("iphone-inline-video is not guaranteed to work in emulated environments")}}return function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.mp4=e.mp4,this.ele=e.ele,this.controlConfig=e.controlConfig||[],this.currentPointId=0,this._init()}var e,i,n;return e=t,(i=[{key:"_init",value:function(){this._setVideo()}},{key:"_setVideo",value:function(){this.player=document.createElement("video"),this.player.setAttribute("playsinline","true"),this.player.setAttribute("webkit-playsinline","true"),this.player.setAttribute("x-webkit-airplay","allow"),this.player.setAttribute("x5-video-player-type","h5"),this.player.setAttribute("x5-video-player-fullscreen","true"),this.player.setAttribute("x5-video-orientation","portraint"),this.player.poster="http://app.fansiji.com/h5/wyklhw2/images/index.jpg?Sdfds",this.player.src=this.mp4,this.player.preload="preload",this.player.controls=!1,this.player.style.width="100%",this.player.style.height="100%",this.player.style.objectFit="cover",this.player.style.backgroundSize="100% 100%",document.querySelector(this.ele).appendChild(this.player),this.isVid=!0,this._addCss(),this._isIos()&&A(this.player)}},{key:"_addCss",value:function(){var e=document.createElement("style");e.innerHTML=".IIV::-webkit-media-controls-play-button,.IIV::-webkit-media-controls-start-playback-button {opacity: 0;pointer-events: none;width: 5px;}",document.getElementsByTagName("head")[0].appendChild(e)}},{key:"_isIos",value:function(){return!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)}},{key:"_isInWX",value:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)+""}},{key:"seek",value:function(e){this.player.currentTime=e}},{key:"_remove",value:function(e){e.parentNode.removeChild(e)}},{key:"destroy",value:function(){this.player.muted,this.player.pause(),this._remove(this.player)}},{key:"play",value:function(){this.player.play(),"[object Array]"===Object.prototype.toString.call(this.controlConfig)&&0<this.controlConfig.length&&this.enterFrame()}},{key:"pause",value:function(){this.player.pause()}},{key:"mute",value:function(e){this.player.muted=!!e}},{key:"enterFrame",value:function(){var e=this.player.currentTime.toFixed(1);requestAnimationFrame(this.enterFrame.bind(this)),this.currentPointId<this.controlConfig.length&&parseFloat(e)==this.controlConfig[this.currentPointId].time&&(this.controlConfig[this.currentPointId].handle(),this.currentPointId++)}},{key:"stopFrame",value:function(){cancelAnimationFrame(this.enterFrame.bind(this))}}])&&r(e.prototype,i),n&&r(e,n),t}()});
